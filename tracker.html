<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Veyra-9 â€¢ Combat Tracker</title>
<style>
:root{
  --bg:#f6f7fb; --ink:#0b0f18; --muted:#3a4150;
  --line:#d7dbea; --panel:#ffffff;
  --brand:#0b3d7a; --brandSoft:#6aa0ff;
  --chip:#eaf1ff; --chipLine:#c9d8ff;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
.wrap{max-width:1100px;margin:0 auto;padding:16px}

header.top{display:flex;justify-content:space-between;align-items:center;
  padding:12px 16px;background:#eef5ff;border-bottom:1px solid var(--line)}
header.top h1{margin:0;font-size:1.1rem;color:var(--brand)}

.pill{background:var(--chip);border:1px solid var(--chipLine);color:var(--brand);
  border-radius:999px;padding:4px 10px;font-weight:700}
.btn{background:#fff;border:1px solid var(--line);border-radius:8px;padding:6px 10px;cursor:pointer}
.btn:hover{background:#f7faff}

.panel{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:16px}
.addgrid{display:grid;grid-template-columns:1.2fr .6fr .6fr .6fr .6fr auto;gap:8px}
.row{display:grid;grid-template-columns:1.2fr .6fr .6fr .6fr .6fr auto;gap:8px;align-items:center;padding:8px 0;border-bottom:1px dashed var(--line)}
.row input{width:100%}
.row.dead{opacity:.55;text-decoration:line-through}
.small{color:var(--muted);font-size:.9rem}
</style>
</head>
<body>
<!-- Global nav (auto-built by assets/nav.js) -->
<header class="v9-header"></header>
<link rel="stylesheet" href="assets/nav.css">
<script defer src="assets/nav.js"></script>

<header class="top">
  <h1>Combat Tracker</h1>
  <div style="display:flex;gap:8px;align-items:center">
    <span class="pill" id="roundPill">Round 1</span>
    <button class="btn" id="nextRoundBtn">Next rd</button>
    <button class="btn" id="clearBtn">Clear</button>
    <button class="btn" onclick="window.close()">Close</button>
  </div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="addgrid" style="margin-bottom:10px">
      <input id="addName" placeholder="Name (PC/NPC)">
      <input id="addInit" type="number" placeholder="Init">
      <input id="addAC"   type="number" placeholder="AC">
      <input id="addHP"   type="number" placeholder="HP">
      <input id="addTH"   type="number" placeholder="THAC0/Atk">
      <button class="btn" id="addBtn">Add</button>
    </div>

    <div class="small">Click a value to edit. Use âœ“ to mark acted; ðŸ’¥ to toggle defeated.</div>

    <div id="rows"></div>
  </div>
</div>

<script>
let v9TrackerState = { round: 1, rows: [] };

function save(){ localStorage.setItem('v9_tracker', JSON.stringify(v9TrackerState)); }
function load(){
  const s = localStorage.getItem('v9_tracker');
  if (s) v9TrackerState = JSON.parse(s);
  render();
}

function render(){
  document.getElementById('roundPill').textContent = `Round ${v9TrackerState.round||1}`;
  const host = document.getElementById('rows'); host.innerHTML='';
  v9TrackerState.rows
    .slice()
    .sort((a,b)=> (b.init||0)-(a.init||0))
    .forEach((r,i)=>{
      const row = document.createElement('div');
      row.className = 'row' + (r.dead?' dead':'');
      row.innerHTML = `
        <input value="${r.name||''}"  data-k="name">
        <input value="${r.init||''}"  data-k="init" type="number">
        <input value="${r.ac||''}"    data-k="ac"   type="number">
        <input value="${r.hp||''}"    data-k="hp"   type="number">
        <input value="${r.th||''}"    data-k="th"   type="number">
        <div style="display:flex;gap:6px">
          <button class="btn" data-act="acted">âœ“</button>
          <button class="btn" data-act="dead">ðŸ’¥</button>
          <button class="btn" data-act="del">ðŸ—‘</button>
        </div>`;
      row.querySelectorAll('input').forEach(inp=>{
        inp.addEventListener('change',()=>{
          v9TrackerState.rows[i][inp.dataset.k] = inp.type==='number'? Number(inp.value): inp.value;
          save();
        });
      });
      row.querySelector('[data-act="del"]').onclick = ()=>{ v9TrackerState.rows.splice(i,1); save(); render(); };
      row.querySelector('[data-act="dead"]').onclick= ()=>{ v9TrackerState.rows[i].dead = !v9TrackerState.rows[i].dead; save(); render(); };
      row.querySelector('[data-act="acted"]').onclick= ()=>{ v9TrackerState.rows[i].acted = !v9TrackerState.rows[i].acted; save(); render(); };
      host.appendChild(row);
    });
}

document.getElementById('addBtn').onclick = ()=>{
  const name = document.getElementById('addName').value.trim();
  if (!name) return;
  v9TrackerState.rows.push({
    name,
    init: Number(document.getElementById('addInit').value||0),
    ac:   Number(document.getElementById('addAC').value||0),
    hp:   Number(document.getElementById('addHP').value||0),
    th:   Number(document.getElementById('addTH').value||0),
    dead:false, acted:false
  });
  save(); render();
  ['addName','addInit','addAC','addHP','addTH'].forEach(id=>document.getElementById(id).value='');
};

document.getElementById('nextRoundBtn').onclick = ()=>{ v9TrackerState.round=(v9TrackerState.round||1)+1; save(); render(); };
document.getElementById('clearBtn').onclick = ()=>{ v9TrackerState = { round:1, rows:[] }; save(); render(); };

/* Sync when drawer (or another tab) changes */
window.addEventListener('storage',(e)=>{ if(e.key==='v9_tracker'){ load(); } });

load(); // bootstrap
</script>
</body>
</html>