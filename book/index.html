<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Echoes of the Machine War · Phase 1</title>

  <!-- Themeable Docsify & theme -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css">
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div id="app"></div>

  <script>
    window.$docsify = {
      name: 'Echoes of the Machine War',
      loadSidebar: true,
      auto2top: true,
      subMaxLevel: 2,
      alias: {
        '/': '/README.md',
      },
      // start page
      homepage: 'README.md',
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/docsify@4/lib/docsify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>

  <!-- Pager + progress (non-intrusive) -->
  <script>
    (function () {
      const routes = [
        { t: 'Arc 1 — Miners’ Desperation', p: 'phase-1/arc1.md' },
        { t: 'Arc 2 — Spire of Quiet Lies',  p: 'phase-1/arc2.md' },
        { t: 'Arc 3 — Security Deck Stabilization', p: 'phase-1/arc3.md' },
        { t: 'Arc 4 — Mouths of Power', p: 'phase-1/arc4.md' },
        { t: 'Arc 5 — Security Deck (aftermath)', p: 'phase-1/arc5.md' },
        { t: 'Arc 6 — The Public Forum', p: 'phase-1/arc6.md' },
        { t: 'Arc 7 — Crossfire, Consequences', p: 'phase-1/arc7.md' },
        { t: 'Arc 8 — The Black Vault', p: 'phase-1/arc8.md' },
        { t: 'Arc 9 — The Aftermath', p: 'phase-1/arc9.md' }
      ];

      function currentIdx(path) {
        const clean = path.replace(/^#\//,'');
        const i = routes.findIndex(r => clean === r.p);
        return i >= 0 ? i : 0;
      }

      function navTo(i){
        i = Math.max(0, Math.min(routes.length-1, i));
        location.hash = '#/' + routes[i].p;
      }

      function ensurePager(){
        let bar = document.querySelector('.v9-pager');
        if (!bar){
          bar = document.createElement('div');
          bar.className = 'v9-pager';
          bar.innerHTML = `
            <button class="prev" title="Previous">← Prev</button>
            <div class="crumb"></div>
            <button class="next" title="Next">Next →</button>
            <div class="progress"><span></span></div>
          `;
          document.body.appendChild(bar);
          bar.querySelector('.prev').onclick = () => navTo(currentIdx(location.hash)-1);
          bar.querySelector('.next').onclick = () => navTo(currentIdx(location.hash)+1);
        }
        return bar;
      }

      function updatePager(){
        const i = currentIdx(location.hash);
        const bar = ensurePager();
        bar.querySelector('.crumb').textContent = routes[i].t;
        bar.querySelector('.prev').disabled = (i===0);
        bar.querySelector('.next').disabled = (i===routes.length-1);
        const pct = Math.round(((i+1)/routes.length)*100);
        bar.querySelector('.progress span').style.width = pct + '%';
      }

      // Docsify plugin hook
      window.$docsify.plugins = (window.$docsify.plugins || []).concat(function (hook, vm) {
        window.addEventListener('hashchange', updatePager, true);
        hook.doneEach(updatePager);
      });
    })();
  </script>
</body>
</html>
